(()=>{"use strict";Vue.component("search",{props:[],template:'<div class="search"><input type="search" v-on:keydown.enter="filterGoods" v-model="app.searchLine" placeholder="Type and press enter"></div>'}),new Vue({el:"#app",data:{goods:[],filteredGoods:[],basketGoods:[],searchLine:"",isVisibleCart:!0,totalPriceMessage:"",totalPriceCoin:""},methods:{makeGETRequest:e=>new Promise(((t,o)=>{let s=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject;s.open("GET",e,!0),s.onload=()=>t(JSON.parse(s.responseText)),s.onerror=()=>o(s.statusText),s.send()})),makePOSTRequest(e,t,o){let s;window.XMLHttpRequest?s=new XMLHttpRequest:window.ActiveXObject&&(s=new ActiveXObject("Microsoft.XMLHTTP")),s.onreadystatechange=function(){4===s.readyState&&o(s.responseText)},s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(t)},addToBasket(e){let t;this.goods.forEach((function(o){e==o.id&&(t={id:o.id,title:o.title,price:o.price,img:o.img})})),this.basketGoods.push(t),this.calcAllGoods(),this.makePOSTRequest("/addToCart",t)},deleteFromBasket(e){let t;this.basketGoods.forEach((function(o,s){let i=o.id;e==i&&(t=s)})),this.basketGoods.splice(t,1),this.calcAllGoods(),this.makePOSTRequest("/updateCart",this.basketGoods)},viewCart(){switch(this.isVisibleCart){case!1:this.isVisibleCart=!0;break;case!0:this.isVisibleCart=!1}},calcAllGoods(){let e=0;this.basketGoods.forEach((t=>{void 0!==t.price&&(e+=t.price)})),this.totalPriceMessage="Cумма товаров в корзине: "+e,this.totalPriceCoin=e},filterGoods(){let e=new RegExp(this.searchLine,"i");this.filteredGoods=this.goods.filter((t=>e.test(t.title)))}},async created(){try{this.goods=await this.makeGETRequest("response.json"),this.filteredGoods=this.goods}catch(e){console.error(e)}},mounted(){this.makeGETRequest("/catalogData",(e=>{this.goods=JSON.parse(e),this.filteredGoods=JSON.parse(e)}))}}),Vue.component("goods-list",{props:["goods"],template:'<section class="goods-list"><slot name="title"></slot><goods-item v-for="good in goods" :key="good.id" :good="good"></goods-item><slot name="nothing"></section>'}),Vue.component("goods-item",{props:["good"],template:'<div class="goods-item"><img :src="good.img" :alt="good.title"><h3>{{good.title}}</h3><p>{{good.price}}</p><button :id="good.id" v-on:click="addBasket(event)">Добавить</button></div>'}),Vue.component("basket-list",{props:["goods"],template:'<aside class="basket-list"><slot name="title"></slot><basket-item v-for="good in goods" :key="good.id" :good="good"></basket-item><slot name="totalCart"></slot></aside>'}),Vue.component("basket-item",{props:["good"],template:'<div class="basket-item"><img :src="good.img" :alt="good.title"><button :id="good.id" v-on:click="deleteItem(event)">&times;</button><div class="basket-item-info"><h3>{{good.title}}</h3><p>{{good.price}}</p></div></div>'})})();